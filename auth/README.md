# Auth Service

## General

В данной ветке представлено решение ДЗ 4 и 7, а именно:
* доступна регистрация пользователей по e-mail и паролю
* реализована авторизация по тем же данным (за счёт `JWT`)
* доступен механизм обмена `refresh token` на пару новых `(refresh, access)`
* есть возможность верифицировать `token` при помощи gRPC
* ограничен доступ к редактированию товаров

## Deploying with Docker-Compose
```bash
docker-compose up
```

## API

У сервиса есть следующие методы:
1. `PUT /api/register_admin` принимает JSON c полями `email` и `password` от пользователя с правами администратора,
после регистрирует нового администратора.
2. `PUT /api/register_user` принимает JSON с полями `email`, `password` и (опциально) `phone_number`, 
после чего возвращает сообщение о том, удалось ли добавить нового пользователя с такой почтой, 
а также высылает сообщение с ссылкой на подтверждение регистрации либо на почту, либо на телефон
3. `GET /api/confirm_registration` ожидает параметр `token` присланный в `email` письме или в SMS, подтверждение регистрации
4. `POST /api/authorize_user` принимает такой же JSON, 
 после успешной авторизации возвращает пару `(refresh, access) tokens`
5. `POST /api/refresh_token` ожидает JSON с полем `refresh`, где должен находиться `refresh token`, 
после чего возвращает новую пару `(refresh, access) tokens` (старый `refresh token` становится недействительным)
6. gRPC `Verify(Token)` метод для верификации токенов.

Права доступа относительно `online-store`: чтение (`GET` запросы) можно совершать любым пользователям,
однако любое изменение данных (`PUT, POST, DELETE` запросы) требует прав администратора.


## Postman Schema 

К решению приложена коллекция для Postman, в которой сохранены примеры запросов API (как прошлых ДЗ, так и нового).
К любому запросу, требующему авторизацию, нужно:
1. открыть вкладку `Authorization`
2. выбрать `Type: Bearer Token`
3. вставить `access token` (который даётся при авторизации) в поле `Token` справа 
